!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).jarallaxVideo=t()}(this,function(){"use strict";let e;var n=e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(){this.doneCallbacks=[],this.failCallbacks=[]}t.prototype={execute(e,t){let o=e.length;for(t=Array.prototype.slice.call(t);o;)e[--o].apply(null,t)},resolve(...e){this.execute(this.doneCallbacks,e)},reject(...e){this.execute(this.failCallbacks,e)},done(e){this.doneCallbacks.push(e)},fail(e){this.failCallbacks.push(e)}};let i=0,a=0,l=0,o=0,r=0;const s=new t,p=new t;class d{constructor(e,t){var o=this;o.url=e,o.options_default={autoplay:!1,loop:!1,mute:!1,volume:100,showControls:!0,accessibilityHidden:!1,startTime:0,endTime:0},o.options=o.extend({},o.options_default,t),void 0!==o.options.showContols&&(o.options.showControls=o.options.showContols,delete o.options.showContols),o.videoID=o.parseURL(e),o.videoID&&(o.ID=i,i+=1,o.loadAPI(),o.init())}extend(...o){const i=o[0]||{};return Object.keys(o).forEach(t=>{o[t]&&Object.keys(o[t]).forEach(e=>{i[e]=o[t][e]})}),i}parseURL(e){var t=!(!(t=(t=e).match(/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/))||11!==t[1].length)&&t[1],o=!(!(o=(o=e).match(/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/))||!o[3])&&o[3],e=function(e){const t=e.split(/,(?=mp4\:|webm\:|ogv\:|ogg\:)/),o={};let i=0;return t.forEach(e=>{e=e.match(/^(mp4|webm|ogv|ogg)\:(.*)/);e&&e[1]&&e[2]&&(o["ogv"===e[1]?"ogg":e[1]]=e[2],i=1)}),!!i&&o}(e);return t?(this.type="youtube",t):o?(this.type="vimeo",o):!!e&&(this.type="local",e)}isValid(){return!!this.videoID}on(e,t){this.userEventsList=this.userEventsList||[],(this.userEventsList[e]||(this.userEventsList[e]=[])).push(t)}off(o,i){this.userEventsList&&this.userEventsList[o]&&(i?this.userEventsList[o].forEach((e,t)=>{e===i&&(this.userEventsList[o][t]=!1)}):delete this.userEventsList[o])}fire(e,...t){this.userEventsList&&void 0!==this.userEventsList[e]&&this.userEventsList[e].forEach(e=>{e&&e.apply(this,t)})}play(e){const t=this;t.player&&("youtube"===t.type&&t.player.playVideo&&(void 0!==e&&t.player.seekTo(e||0),n.YT.PlayerState.PLAYING!==t.player.getPlayerState()&&t.player.playVideo()),"vimeo"===t.type&&(void 0!==e&&t.player.setCurrentTime(e),t.player.getPaused().then(e=>{e&&t.player.play()})),"local"===t.type&&(void 0!==e&&(t.player.currentTime=e),t.player.paused&&t.player.play()))}pause(){const t=this;t.player&&("youtube"===t.type&&t.player.pauseVideo&&n.YT.PlayerState.PLAYING===t.player.getPlayerState()&&t.player.pauseVideo(),"vimeo"===t.type&&t.player.getPaused().then(e=>{e||t.player.pause()}),"local"!==t.type||t.player.paused||t.player.pause())}mute(){var e=this;e.player&&("youtube"===e.type&&e.player.mute&&e.player.mute(),"vimeo"===e.type&&e.player.setVolume&&e.player.setVolume(0),"local"===e.type&&(e.$video.muted=!0))}unmute(){var e=this;e.player&&("youtube"===e.type&&e.player.mute&&e.player.unMute(),"vimeo"===e.type&&e.player.setVolume&&e.player.setVolume(e.options.volume),"local"===e.type&&(e.$video.muted=!1))}setVolume(e=!1){var t=this;t.player&&e&&("youtube"===t.type&&t.player.setVolume&&t.player.setVolume(e),"vimeo"===t.type&&t.player.setVolume&&t.player.setVolume(e),"local"===t.type&&(t.$video.volume=e/100))}getVolume(t){var e=this;e.player?("youtube"===e.type&&e.player.getVolume&&t(e.player.getVolume()),"vimeo"===e.type&&e.player.getVolume&&e.player.getVolume().then(e=>{t(e)}),"local"===e.type&&t(100*e.$video.volume)):t(!1)}getMuted(t){var e=this;e.player?("youtube"===e.type&&e.player.isMuted&&t(e.player.isMuted()),"vimeo"===e.type&&e.player.getVolume&&e.player.getVolume().then(e=>{t(!!e)}),"local"===e.type&&t(e.$video.muted)):t(null)}getImageURL(t){const o=this;if(o.videoImage)t(o.videoImage);else{if("youtube"===o.type){const i=["maxresdefault","sddefault","hqdefault","0"];let e=0;const a=new Image;a.onload=function(){120!==(this.naturalWidth||this.width)||e===i.length-1?(o.videoImage=`https://img.youtube.com/vi/${o.videoID}/${i[e]}.jpg`,t(o.videoImage)):(e+=1,this.src=`https://img.youtube.com/vi/${o.videoID}/${i[e]}.jpg`)},a.src=`https://img.youtube.com/vi/${o.videoID}/${i[e]}.jpg`}if("vimeo"===o.type){let e=new XMLHttpRequest;e.open("GET","https://vimeo.com/api/oembed.json?url="+o.url,!0),e.onreadystatechange=function(){var e;4===this.readyState&&200<=this.status&&this.status<400&&((e=JSON.parse(this.responseText)).thumbnail_url&&(o.videoImage=e.thumbnail_url,t(o.videoImage)))},e.send(),e=null}}}getIframe(e){this.getVideo(e)}getVideo(t){const l=this;l.$video?t(l.$video):l.onAPIready(()=>{let e;if(l.$video||((e=document.createElement("div")).style.display="none"),"youtube"===l.type){l.playerOptions={host:"https://www.youtube-nocookie.com",videoId:l.videoID,playerVars:{autohide:1,rel:0,autoplay:0,playsinline:1}},l.options.showControls||(l.playerOptions.playerVars.iv_load_policy=3,l.playerOptions.playerVars.modestbranding=1,l.playerOptions.playerVars.controls=0,l.playerOptions.playerVars.showinfo=0,l.playerOptions.playerVars.disablekb=1);let t,o;l.playerOptions.events={onReady(t){l.options.mute?t.target.mute():l.options.volume&&t.target.setVolume(l.options.volume),l.options.autoplay&&l.play(l.options.startTime),l.fire("ready",t),l.options.loop&&!l.options.endTime&&(l.options.endTime=l.player.getDuration()-.1),setInterval(()=>{l.getVolume(e=>{l.options.volume!==e&&(l.options.volume=e,l.fire("volumechange",t))})},150)},onStateChange(e){l.options.loop&&e.data===n.YT.PlayerState.ENDED&&l.play(l.options.startTime),t||e.data!==n.YT.PlayerState.PLAYING||(t=1,l.fire("started",e)),e.data===n.YT.PlayerState.PLAYING&&l.fire("play",e),e.data===n.YT.PlayerState.PAUSED&&l.fire("pause",e),e.data===n.YT.PlayerState.ENDED&&l.fire("ended",e),e.data===n.YT.PlayerState.PLAYING?o=setInterval(()=>{l.fire("timeupdate",e),l.options.endTime&&l.player.getCurrentTime()>=l.options.endTime&&(l.options.loop?l.play(l.options.startTime):l.pause())},150):clearInterval(o)},onError(e){l.fire("error",e)}};var i=!l.$video;if(i){const a=document.createElement("div");a.setAttribute("id",l.playerID),e.appendChild(a),document.body.appendChild(e)}l.player=l.player||new n.YT.Player(l.playerID,l.playerOptions),i&&(l.$video=document.getElementById(l.playerID),l.options.accessibilityHidden&&(l.$video.setAttribute("tabindex","-1"),l.$video.setAttribute("aria-hidden","true")),l.videoWidth=parseInt(l.$video.getAttribute("width"),10)||1280,l.videoHeight=parseInt(l.$video.getAttribute("height"),10)||720)}if("vimeo"===l.type){if(l.playerOptions={dnt:1,id:l.videoID,autopause:0,transparent:0,autoplay:l.options.autoplay?1:0,loop:l.options.loop?1:0,muted:l.options.mute?1:0},l.options.volume&&(l.playerOptions.volume=l.options.volume),l.options.showControls||(l.playerOptions.badge=0,l.playerOptions.byline=0,l.playerOptions.portrait=0,l.playerOptions.title=0,l.playerOptions.background=1),!l.$video){let t="";Object.keys(l.playerOptions).forEach(e=>{""!==t&&(t+="&"),t+=e+"="+encodeURIComponent(l.playerOptions[e])}),l.$video=document.createElement("iframe"),l.$video.setAttribute("id",l.playerID),l.$video.setAttribute("src",`https://player.vimeo.com/video/${l.videoID}?`+t),l.$video.setAttribute("frameborder","0"),l.$video.setAttribute("mozallowfullscreen",""),l.$video.setAttribute("allowfullscreen",""),l.$video.setAttribute("title","Vimeo video player"),l.options.accessibilityHidden&&(l.$video.setAttribute("tabindex","-1"),l.$video.setAttribute("aria-hidden","true")),e.appendChild(l.$video),document.body.appendChild(e)}l.player=l.player||new n.Vimeo.Player(l.$video,l.playerOptions),l.options.startTime&&l.options.autoplay&&l.player.setCurrentTime(l.options.startTime),l.player.getVideoWidth().then(e=>{l.videoWidth=e||1280}),l.player.getVideoHeight().then(e=>{l.videoHeight=e||720});let t;l.player.on("timeupdate",e=>{t||(l.fire("started",e),t=1),l.fire("timeupdate",e),l.options.endTime&&l.options.endTime&&e.seconds>=l.options.endTime&&(l.options.loop?l.play(l.options.startTime):l.pause())}),l.player.on("play",e=>{l.fire("play",e),l.options.startTime&&0===e.seconds&&l.play(l.options.startTime)}),l.player.on("pause",e=>{l.fire("pause",e)}),l.player.on("ended",e=>{l.fire("ended",e)}),l.player.on("loaded",e=>{l.fire("ready",e)}),l.player.on("volumechange",e=>{l.fire("volumechange",e)}),l.player.on("error",e=>{l.fire("error",e)})}if("local"===l.type){l.$video||(l.$video=document.createElement("video"),l.options.showControls&&(l.$video.controls=!0),l.options.mute?l.$video.muted=!0:l.$video.volume&&(l.$video.volume=l.options.volume/100),l.options.loop&&(l.$video.loop=!0),l.$video.setAttribute("playsinline",""),l.$video.setAttribute("webkit-playsinline",""),l.options.accessibilityHidden&&(l.$video.setAttribute("tabindex","-1"),l.$video.setAttribute("aria-hidden","true")),l.$video.setAttribute("id",l.playerID),e.appendChild(l.$video),document.body.appendChild(e),Object.keys(l.videoID).forEach(e=>{{var t=l.$video,o=l.videoID[e];e="video/"+e;const i=document.createElement("source");return i.src=o,i.type=e,void t.appendChild(i)}})),l.player=l.player||l.$video;let t;l.player.addEventListener("playing",e=>{t||l.fire("started",e),t=1}),l.player.addEventListener("timeupdate",function(e){l.fire("timeupdate",e),l.options.endTime&&l.options.endTime&&this.currentTime>=l.options.endTime&&(l.options.loop?l.play(l.options.startTime):l.pause())}),l.player.addEventListener("play",e=>{l.fire("play",e)}),l.player.addEventListener("pause",e=>{l.fire("pause",e)}),l.player.addEventListener("ended",e=>{l.fire("ended",e)}),l.player.addEventListener("loadedmetadata",function(){l.videoWidth=this.videoWidth||1280,l.videoHeight=this.videoHeight||720,l.fire("ready"),l.options.autoplay&&l.play(l.options.startTime)}),l.player.addEventListener("volumechange",e=>{l.getVolume(e=>{l.options.volume=e}),l.fire("volumechange",e)}),l.player.addEventListener("error",e=>{l.fire("error",e)})}t(l.$video)})}init(){this.playerID="VideoWorker-"+this.ID}loadAPI(){if(!a||!l){let o="";if("youtube"!==this.type||a||(a=1,o="https://www.youtube.com/iframe_api"),"vimeo"===this.type&&!l){if(l=1,void 0!==n.Vimeo)return;o="https://player.vimeo.com/api/player.js"}if(o){let e=document.createElement("script"),t=document.getElementsByTagName("head")[0];e.src=o,t.appendChild(e),t=null,e=null}}}onAPIready(e){if("youtube"===this.type&&(void 0!==n.YT&&0!==n.YT.loaded||o?"object"==typeof n.YT&&1===n.YT.loaded?e():s.done(()=>{e()}):(o=1,n.onYouTubeIframeAPIReady=function(){n.onYouTubeIframeAPIReady=null,s.resolve("done"),e()})),"vimeo"===this.type)if(void 0!==n.Vimeo||r)void 0!==n.Vimeo?e():p.done(()=>{e()});else{r=1;const t=setInterval(()=>{void 0!==n.Vimeo&&(clearInterval(t),p.resolve("done"),e())},20)}"local"===this.type&&e()}}let u;var y,m=u="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function v(e=m.jarallax){if(void 0!==e){const t=e.constructor,i=t.prototype.onScroll,o=(t.prototype.onScroll=function(){const o=this;i.apply(o),o.isVideoInserted||!o.video||o.options.videoLazyLoading&&!o.isElementInViewport||o.options.disableVideo()||(o.isVideoInserted=!0,o.video.getVideo(e=>{const t=e.parentNode;o.css(e,{position:o.image.position,top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",pointerEvents:"none",transformStyle:"preserve-3d",backfaceVisibility:"hidden",willChange:"transform,opacity",margin:0,zIndex:-1}),o.$video=e,"local"===o.video.type&&(o.image.src?o.$video.setAttribute("poster",o.image.src):o.image.$item&&"IMG"===o.image.$item.tagName&&o.image.$item.src&&o.$video.setAttribute("poster",o.image.$item.src)),o.image.$container.appendChild(e),t.parentNode.removeChild(t),o.options.onVideoInsert&&o.options.onVideoInsert.call(o)}))},t.prototype.coverImage),a=(t.prototype.coverImage=function(){var a=this,l=o.apply(a),n=!!a.image.$item&&a.image.$item.nodeName;if(l&&a.video&&n&&("IFRAME"===n||"VIDEO"===n)){let e=l.image.height,t=e*a.image.width/a.image.height,o=(l.container.width-t)/2,i=l.image.marginTop;l.container.width>t&&(t=l.container.width,e=t*a.image.height/a.image.width,o=0,i+=(l.image.height-e)/2),"IFRAME"===n&&(e+=400,i-=200),a.css(a.$video,{width:t+"px",marginLeft:o+"px",height:e+"px",marginTop:i+"px"})}return l},t.prototype.initImg),l=(t.prototype.initImg=function(){var e=this,t=a.apply(e);return e.options.videoSrc||(e.options.videoSrc=e.$item.getAttribute("data-jarallax-video")||null),e.options.videoSrc?(e.defaultInitImgResult=t,!0):t},t.prototype.canInitParallax),n=(t.prototype.canInitParallax=function(){const o=this;let e=l.apply(o);if(o.options.videoSrc){const i=new d(o.options.videoSrc,{autoplay:!0,loop:o.options.videoLoop,showControls:!1,accessibilityHidden:!0,startTime:o.options.videoStartTime||0,endTime:o.options.videoEndTime||0,mute:o.options.videoVolume?0:1,volume:o.options.videoVolume||0});if(o.options.onVideoWorkerInit&&o.options.onVideoWorkerInit.call(o,i),i.isValid())if(this.options.disableParallax()&&(e=!0,o.image.position="absolute",o.options.type="scroll",o.options.speed=1),e){if(i.on("ready",()=>{if(o.options.videoPlayOnlyVisible){const e=o.onScroll;o.onScroll=function(){e.apply(o),o.videoError||!o.options.videoLoop&&(o.options.videoLoop||o.videoEnded)||(o.isVisible()?i.play():i.pause())}}else i.play()}),i.on("started",()=>{o.image.$default_item=o.image.$item,o.image.$item=o.$video,o.image.width=o.video.videoWidth||1280,o.image.height=o.video.videoHeight||720,o.coverImage(),o.onScroll(),o.image.$default_item&&(o.image.$default_item.style.display="none")}),i.on("ended",()=>{o.videoEnded=!0,o.options.videoLoop||t()}),i.on("error",()=>{o.videoError=!0,t()}),o.video=i,!o.defaultInitImgResult&&(o.image.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","local"!==i.type))return i.getImageURL(e=>{o.image.bgImage=`url("${e}")`,o.init()}),!1}else o.defaultInitImgResult||i.getImageURL(e=>{var t=o.$item.getAttribute("style");t&&o.$item.setAttribute("data-jarallax-original-styles",t),o.css(o.$item,{"background-image":`url("${e}")`,"background-position":"center","background-size":"cover"})});function t(){o.image.$default_item&&(o.image.$item=o.image.$default_item,o.image.$item.style.display="block",o.coverImage(),o.onScroll())}}return e},t.prototype.destroy);t.prototype.destroy=function(){var e=this;e.image.$default_item&&(e.image.$item=e.image.$default_item,delete e.image.$default_item),n.apply(e)}}}return v(),y=()=>{void 0!==m.jarallax&&m.jarallax(document.querySelectorAll("[data-jarallax-video]"))},"complete"===document.readyState||"interactive"===document.readyState?y():document.addEventListener("DOMContentLoaded",y,{capture:!0,once:!0,passive:!0}),m.VideoWorker||(m.VideoWorker=d),v});